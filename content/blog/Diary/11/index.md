---
title: "Tennis Chart(仮)というサイトを作成しました"
postdate: "2023-06-20"
update: "2023-06-21"
seriesName: "日記"
seriesSlug: "Diary"
description: "Tennis Chart(仮)というサイトを作成したので紹介します。"
tags: ["日記", "Next.js", "Rust", "Actix Web"]
keywords: ["日記", "Next.js", "Rust", "Actix Web"]
published: true
---

# Tennis Chart(仮)というサイトを作成しました

このブログには最低月一回は更新するという隠れ努力目標があるのですが、ここ最近は記事をアップできていません。一応記事を作成している努力はしていて、例えばRustのイテレーターについての記事を書いているのですが、アップできるような精度ではないのでまだ下書きの状態です。

今回は苦し紛れの近況報告的な記事です。

Tennis Chart(仮)というサイトを作成しました。

[Tennis Chart(仮)](https://tennis-chart.toriwatari.work/)（[GitHub](https://github.com/kento-yoshidu/TennisChart)）

男子プロテニス界には**BIG4**と呼ばれる、歴史的に見て史上最強クラスの4人組がいる（いた）のですが、彼らがいかに突出した存在だったのかというのをチャートで表そうというサイトです。

「(仮)」とついている通りまだ完成度は30%くらいなのですが、完成までの道筋は見えていて、後はひたすら作業していくという所まで来たので晒します。

## 目的

大きな目的としては２つあり、Reactのチャートライブラリの学習をすること、そしてRustでバックエンドサーバー（Web APIサーバー）を構築すること、です。

一つ目のチャートライブラリに関しては[**Recharts**](https://recharts.org/en-US/)を利用しています。


今は主に[SimpleBarChart](https://recharts.org/en-US/examples/SimpleBarChart)を利用していますが、特に躓くことなくかっこいいチャートが作成できるので感動しています。仕事でチャートを利用したサイト作成がありそうなので、その予行演習になればいいと思っています。

2つ目のRustでのバックエンドサーバーの構築ですが、目的としてはこちらが大きいです。チャートの元になるデータ（誰が何年にどの大会で優勝したか、など）をJSONで返す、いわゆるREST APIサーバーを構築しました。Webフレームワークは[**Actix Web**](https://actix.rs/)を利用しています。


Rust自体は昨年からちょくちょく書いていました。ずっとAtCoderの問題を解いたりしていたのですが、もっと形になるものが作りたいなーと思っていたのと、いい加減バックエンドも勉強しないといけないと思っていたのでRustを採用しました。

Rustの言語仕様を理解するにはまだまだ時間がかかりそうですが、フレームワークを利用したサーバー構築ならそこまで難しくないと感じています（今のところ）。

## 現状の技術スタック

完成度はまだまだ低いですが、現時点での技術スタックは以下の通りです。

### フロントエンド

フロントエンドはNext.jsです。そしてデータフェッチには[**TanStack Query**](https://tanstack.com/query/latest)を使用しています。

REST APIからのデータフェッチはもちろん、ローディングの状態管理、エラーハンドリングまでこなしてくれます。データフェッチに関してはイマイチ王道的な手法がなかったと思うのですが（`useEffect`でデータフェッチをするのに[疑問を投げかける記事](https://zenn.dev/kazuma1989/articles/a30ba6e29b5b4c)があったり）、Tanstack Queryが次の主力になりそうな予感なので早めに慣れておく方がよさそうです。

### バックエンド

肝心のバックエンドですが、今は[**Render**](https://render.com/)というウェブホスティングのサービスにてサーバーを立てています。

最初はAWS Lambdaに乗せようと思ったのですが、1時間やって上手くいかなかったのでRenderに切り替えました（諦めの良さと切り替えの速さが長所😳）。GitHubのリポジトリと連携させるだけで、本当に何もせず簡単にAPIサーバーが公開できてしまいました。でもやっぱりAWSに乗せたいので、サイトが完成してから移行するかもしれません。

なお、開発中ということもあり、Renderのインスタンスは無料プランを利用しています。無料インスタンスは15分アクセスがないとアイドル状態になってしまいます。例えば[ここ](https://tennis-chart.toriwatari.work/page1)にアクセスすると最初は「データ取得中」というメッセージが表示されると思います。

インスタンス起動まで1~2分ほどかかりますので、すみませんがそのままお待ちください。データが取得できれば自動でチャートが表示されます。ちなみに、「データ取得中」という表示や、データを取得できた時の再レンダリングはTanstack Queryが上手いことやってくれています。図らずもその有用性が分かる形になっていますね。

### データベース

チャートの元になるデータは当然何らかのデータベースに置くわけですが、まだテーブル設計も何も出来ていないので、現状はActix Web上でデータをVec型のデータで置いていてそれをJSONで返しています（[このように](https://github.com/kento-yoshidu/TennisChart_Backend/blob/c2894f51de665fae554980d6ef2023ecc55744c3/src/service.rs#L249-L258)、夜なべしてデータを一つ一つ用意しました）。

ただ、ローカルではDockerでPostgreSQLを用意し、そこからデータ取得できることは確認しています。データベースとの連携も簡単で、私は[**sqlx**](https://github.com/launchbadge/sqlx)というライブラリを利用しました。データベースが用意できれば、そのURLを渡すだけでデータ取得できるところまでは用意できています。

実はRenderはPostgreSQLのサービスも提供しているようで、$7でデータベースを一つ利用できます。お手軽なのでこれを利用しようかと考えています。

[PostgreSQL | Render · Cloud Hosting for Developers](https://render.com/docs/databases)

---

というわけで現在の完成度は30%くらいな訳です。特にデータベースに関してはまだまだこれからですね。これからの開発ロードマップとしては、

1. どのようなチャートを用意するかを決定する
2. テーブル設計
3. DBサーバーを構築する(AWS? Render?)
4. AWSにActix Webを移行する

という感じで見積もっています。今までデータベース設計からは逃げてきたので、ここが一番苦労しそうです。

## 感想

Rustでのバックエンド開発、データベースとの連携、Webへのデプロイなど、Rustに関する全てが初めてだったので不安でしたが、ひとまず骨組みは出来たので安心しました。Rustでバックエンド開発ができそうで嬉しいです。

ちなみに`Yew`というRustのフレームワークでフロントエンド開発もしています。Tennis ChartのフロントエンドもYewにしようかと考えましたが、まだ自分には重そうなのでやめておきました。まずベタだけどTodoアプリとかからですね。

## 参考

[Rustのactix-web を触ってみる](https://blog.foresta.me/posts/actix-web-sample/)

[Yew](https://yew.rs/ja/)

<details style="margin-top: 60px" class="history">
<summary>更新履歴</summary>

<ul class="history-list">
  <li>2023年6月21日 : 誤字脱字を修正。</li>
</details>
