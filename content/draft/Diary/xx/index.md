---
title: "My Formsというサイトを作成しました"
postdate: "2023-05-08"
update: "2023-05-08"
seriesName: "日記"
seriesSlug: "Diary"
description: ""
tags: ["日記", "Next.js"]
keywords: ["日記", "Next.js"]
published: false
---

# MyFormsというサイトを作成しました

このブログには最低月一回は更新するという努力目標があるのですが、ここ最近は記事をアップできていません。一応記事を作成している努力はしていて、例えばRustの所有権についての記事を書いているのですが、アップできるような精度ではないのでまだ下書きの状態です。

今回は、苦し紛れの近況報告的な記事です。

今年に入ってMy Formsというサイトを作成しました。ダミーのフォームを沢山作成し、リストアップしているサイトです。

[My Forms](https://myforms.toriwatari.work/)（[GitHub](https://github.com/kento-yoshidu/MyForms)）

多分今年の2月くらいに一旦サイトは完成していたんですが、肝心のフォームは一つしか作れていませんでした。そこで、GWを利用してフォームをいくつか追加したり、デザインを整えたりしていました。

今回はこのサイトについての簡単な説明をします。

## 目的

大きな目的としては、**UI/UX**、**アクセシビリティ**に関する力を底上げすることです。フロントエンドの技術に触れている風を装っておきながら、これらについては見てみないふりをしていたのでちゃんと勉強することにしました。

なぜフォームを題材にしたかといえば、HTMLにおいて、恐らく作成するのが一番難しい要素がフォームであるからです。フォームを自由自在に操ることができれば、大抵のUIの作成においても合格点をとることができると予測しました。

そしてもっと細かく言うと、フォームの作成を通じて以下の要素についてレベルアップできると考えています。

- ✔ UI/UX
- ✔ HTML(フォームに関する要素)
- ✔ Webアクセシビリティ(WAI-ARIA)
- ✔ React Hooksや各種ライブラリー
- ✔ テストコードの書き方(React Testing Library)
- ✔ 支援技術(NVDA)

特に力を入れているのがテストコードの作成です（テストコードは[こちら](https://github.com/kento-yoshidu/MyForms/tree/main/__tests__）で確認できます)。各フォームにおいて、考えられる全てのケース（ユーザー操作）を予測し、テストケースを作成しています。プルリクエストを投げた時にGitHub Actionsが走り、テストが通るかをチェックします。テストについては後述します。

また、今回からWAI-ARIAについても勉強しています。WAI-ARIAは勉強しないとダメだけど後回しにしがち（自分だけ？）だと思うんですが、フォームの作成には特に絡んでくる要素であり、強制的に勉強することになります。

## テストコード

文字数を稼ぐため、実際にどのようなテストコードを書いているかを述べたいと思います。

[Form2](https://myforms.toriwatari.work/form2)を題材にします。名前変換フォームと関している通り、テキストボックスに入力した小文字のアルファベットを大文字にして表示するというものです。

### フォームの特徴

まず、Form2の仕様についてざっと説明します。Form2のテーマは「**必須項目を埋めていない時、どのようにしてそれをユーザーに伝えるか**」です。

入力する項目は「お名前」ひとつだけです。この項目は入力が必須ですので <span style="color: red">※ 必須</span> と記述し、入力を促しています。

![見えやすい位置に赤い文字で必須と記載している](./images/image01.png)

また、必須項目を入力するまではボタンを押せない状態（disabled）になっています。これはこれで良いUIなのかという疑問はありますが、Form2のテーマを実現するため今回はそういう手段をとった、ということです。

![必須項目を入力していないため、送信ボタンがdisabledになっている](./images/image02.png)

名前が入力されれば送信ボタンはクリック可能な状態になります。なお、どのような文字でも入力可能な状態になっています。本来は正規表現にかけるべきところですが、今回のテーマとは直接関係ないので省いています（ただ、スペースのみ、という入力は弾いています）。

![必須項目を入力したことで送信ボタンがクリック可能になっている](./images/image03.png)

さて、例では`takashi`という文字を入力しましたが、これを削除してみます。すると赤い文字でエラーメッセージが表示され、ボタンがまたdisabledになります。フォームが送信できない状態になったことに対して、エラーメッセージで理由を伝えています。

![入力をクリアすると、エラーメッセージが表示され、ボタンがdisabledになる](./images/image04.png)

このエラーメッセージは、`onChange`を使用しテキストボックスの文字数をカウントして表示/非表示を切り替えています。ただ、初回レンダリング時にいきなりエラーメッセージが表示されるとよろしくないので、それを避ける工夫をしています。

なんやかんやでフォームの送信に成功すると、小文字のアルファベットが大文字に置き換わった文字列が表示されます。

![送信内容が大文字に変換されて表示される](./images/image05.png)

以上がForm2の仕様です。

### テストケース

このフォームについて、テストコードはどのように書けばいいでしょうか。まず、以下の3つに大きく分類することにしました。

1. 初回レンダリング時に正しい状態になっているか
2. フォームに文字列を記入/削除した時、各要素が正しい状態に変化するか
3. フォームを送信することで、正しい結果が得られるか

1つ目の「初回レンダリング時に正しい状態になっているか」ですが、以下のように考えました。

- 1-1 初回レンダリング時に送信ボタンが非表示になっているか
- 1-2 初回レンダリング時にエラーメッセージが表示されていないか
- 1-3 初回レンダリング時に変換結果が表示されるエリアに何も表示されていないこと
