---
title: "JamstackなWebサイトを構築してみた②"
postdate: "2021-06-12"
updatedate: "2021-07-09"
seriesName: "JamstackなWebサイトを構築してみた"
seriesSlug: "Jamstack"
description: "いわゆるJamstackなサイトを作成してみて、何となく分かってきたので知見を記載します。"
tags: ["Jamstack", "HeadlessCMS", "SSG"]
---

# Jamstackとはいったい何？

今回からは具体的に「Jamstackってなに？」「SSGやHeadlessCMSって？」ということを考えていきたいと思います。

まずこのページではJamstackとは何かについて、私なりの考えを述べたいと思います。

JamstackのWebサイトにはこう書かれています。

> Jamstack is an architecture designed to make the web faster, more secure, and easier to scale. 

参考：[What is the Jamstack? | Jamstack](https://jamstack.org/what-is-jamstack/)

「高速で安全でスケーラブルなWebサイト構築のためのフレームワーク」といったところでしょうか。抽象的すぎますね。

私が思うにJamstackとは「APIを叩いてコンテンツを取得、静的ファイルを生成し配信するアーキテクチャ」であると言えます。これでも何のこっちゃと思うかもしれませんが、JamstackはSSG + HeadlessCMS + CDNを組み合わせたアーキテクチャであるとすれば、幾分シンプルだと思います。

## 言葉の由来

Jamstackはもともと「JAMStack」と呼ばれていました。

JAMstackのJAMは「JavaScript」「APIs」「MarkUp」の頭文字を取った言葉です。要約すると、「JavaScriptでAPIを叩いて、静的なマークアップファイル（HTML、CSS、JavaScript）を配信するアーキテクチャ」だと言えます。

## 従来のWebサイトとの違い

Jamstackとは何かについて、従来のWebサイトの構成との違いから考えたいと思います。当サイトと同じようなブログを展開しているWebサイトを題材にします。

よくあるのは、WebサーバーとDBサーバーを組み合わせた構成だと思います。ブログコンテンツ（記事のタイトルや本文、画像など）はDBサーバーに保存、クライアントからのアクセスがあった時にWebサーバーがHTMLファイルを作成、クライアントに返送するというパターンです。

![](images/image01.png)

また、このようにWebサーバーとDBサーバーをセットにしてWebサイトを構築できるように提供するサービスや仕組みを**CMS**などと言ったりします。あの有名なWordpressがCMSの代表です。

では次にJamstackを考えます。Jamstackを構成するのはWebサーバー（CDN）とAPIの2つです。

従来の仕組みでは「クライアントからのアクセスに応じてHTMLファイルを生成、クライアントに返送」していましたが、Jamstackでは「APIからデータを取得し静的サイトジェネレータ（SSG）を利用して事前に静的ファイルを生成、クライアントに返送」する形になっています。APIは主にHeadlessCMSと呼ばれるマネジメントシステムを使って用意します。

![](images/image02.png)

## Jamstackを利用するメリット

### 高速なWebサイト表示

JamstackではCDNというサービスを使用して、SSGで出力した静的なファイルを配信します。

CDNとは何でしょう？ウィキペディアによると、

> コンテンツデリバリネットワークとは、ウェブコンテンツをインターネット経由で配信するために最適化されたネットワークのことである。コンテンツ配信網とも呼ばれる。

・・・とのことです。

これを一言で言うと「データをコピーした配信サーバーを世界中に配置するネットワーク」です。

通常、WebサーバーやDBサーバーは一か所に固まって置かれていて、世界中からのアクセスを一手に引き受けています（冗長化であったりクラウドサービスを利用して分散させることはできますが、限界はありますしCDNの仕組みとは本質的に違います）。

![](images/image03.png)

CDNの場合、オリジンサーバー（これまででいうWebサーバー本体）から静的ファイルをコピーしたエッジサーバーを世界中に分散し配置します。

クライアントはWebサイトにアクセスする際、オリジンサーバーではなく物理的に近いエッジサーバーからファイルをダウンロードすることになります。オリジンサーバーに基本的に負荷はかかりません。

![](images/image04.png)

また、エッジサーバーの数は、CDNサービスにもよりますが数万台から数十万台とも言われており、「冗長構成」の比ではありません。これが世界中に物理的に分散されているのです。

事前に静的ファイルを生成するSSGと、このCDNという仕組みはとても相性がいいです。対して、バックエンドが介在するWebサイトでは「アクセスがあってからDBに処理を投げ、結果を見て静的ファイルを生成」するわけですから、基本的にCDNは利用しにくいです。

このサイトの場合ですと、AWS Amplifyを用いてCDNでの公開を行っています。

### サーバ負荷、管理コストが減る

従来の構成ではアクセスする度に動的にファイルを生成するため、WebサーバーやDBサーバーにどうしても負荷がかかります。アクセスが集中するとサーバーが落ちる可能性もでてきます。それに伴いCPUやメモリ、ディスク容量のリソース監視をずっと行っていく必要があります。

さらに、LinuxなどのサーバーOS、ApacheやPHP、MySQLなどのミドルウェアの管理も必要です。加えてソフトウェアであるCMS自体のアップデートやプラグインの管理も必要であり、どうしても多くのランニングコストがかかります。

Jamstackならばどうでしょう。コンテンツ管理はHeadlessCMSを利用しAPIに集約されるため、DBをもちません。また、CDNを利用しているため自前でWebサーバーを持たなくてよくなります。

アクセスが集中した時にサーバーが落ちる云々はJamstackにも当てはまりますが、サーバーが分散されているCDNの特徴からしてサーバーが落ちることはそうそうないと思います。また、CDNはマネージド型サービスであることがほとんどですので、サーバー管理から解放されるという意味でもメリットです。

### 技術選択の幅が広がる

フロント（WebサーバーやSSGなどのツール）とコンテンツ管理（API、HeadlessCMSなど）が疎結合になっているため、それぞれを分離して考えることができます。

例えばSSGなら「Gatsby、Next.js、Nuxt.js」という選択肢があり、HeadlessCMSも「microCMS、Contentful、graphCMS」があげられ、それぞれ好きな技術を組み合わせてサイトを構築することができます。

## Jamstackを利用するデメリット

さて、何だかいい所ばかりに見えるJamstack構成ですが、デメリットもあり、また、適用するのに向いていないシーンというのも当然あります。

### プログラミングに関する知識が必要になる

Jamstackサイト構築にはプログラミングの知識が必要になり、これが導入への一番の障壁になります。具体的に言うと、SSGを利用する際にプログラミングの知識が必要になります。知識というのも「HTMLとCSS、JavaScriptなら勉強しました」くらいでは中々太刀打ちできません。

また、CDNを利用してファイルを配信するのでホスティングに関する知識や、デプロイ時にはHeadlessCMSとの連携も考えなくてはいけません。

対してWordpressなどのCMSならどうでしょう。基本的にプログラミングに関する知識は必要とされません。レンタルサーバーによっては自動的にWordpressの準備まで自動でしくてくれるものもありますから、簡単に自分のWebサイトを作成できます。

また、書店に行けばWordpressに関しての入門書もこれでもかというほど豊富にあり、スタートまでのハードルは低いです。対してSSGやJamstackに関する書籍は中々少ない印象ですね。

### 役割が2つにわかれている

Jamstackは主に、コンテンツを管理するHeadlessCMSと、静的ファイルを生成するSSGから構成されています。これは「コンテンツを作成する役割」と「SSGを駆使する役割」とで求められる知識が違うことを意味します。

「ブログを立ち上げたい。プログラミングに関する知識がないから詳しい人に構築を頼もう」という人がいてJamstack構成のサイト作りが選択肢に上がった時、「分業することができる」と捉えればメリットとなりますが、「ブログを立ち上げたい人だけで完結できない」デメリットがあるとも考えられます。

SSGを使用する側がサイトを構築し、「デザインはこれでいいですか？」「思った通りのページになっていますか？」などすり合わせが必要になります。

その点、CMSサービスはコンテンツ管理からサイト公開まで（サービス利用者から見れば）一枚岩になっていますので、自分一人でサイトを作成、管理していくことが可能です。

これは上記の「プログラミングに関する知識が必要になる」と重複する部分も大きいかもしれません。要するに「専門的な知識が必要になる」ということですね。

### ページ生成に時間がかかる

SSGは「静的ファイルを生成する」という仕様上、ビルドの度に全てのページがビルド対象になります。100個の記事があるサイトに新しい記事を1個追加した時、101個分のビルドが行われるということです。そしてその時間がサイト更新までのタイムラグになります。

現在、このブログはページ総数20ページ位、AWS Amplifyを使用してデプロイしていますが、ビルド時間は2分半前後といったところです。また、AWS Amplifyであればビルド時間に応じて料金が発生しますし、その他のホスティングサービスもプランごとにビルド時間の制限があることが多いのでこの点は要注意です。

そして、更新が頻繁にあるサイトにはJamstackは向きません。1分に1回更新があるサイトとかですね。このブログは週に1~2回の更新ペースです。

しかし、動的サイトには「事前ビルド」という考えはありませんので、コンテンツを更新したらすぐさまアクセス可能です。また、レンタルサーバーを借りてるのであれば料金は固定されてることが多いでしょうから金銭面的にも安心です。

### 動的な機能を持たせにくい

動的にページが変わるサイト、ECサイトだったりログイン機能を持つサイトなども該当しますが、これらの構築はバックエンドを持たないJamstackサイトにとって苦手な分野です。

苦手だけで実現できないわけではないらしいですが（正直に言うとあまり分かってない）、それはバックエンドを持つWordpressなどのCMSや、バックエンドのフレームワークを試用したWebアプリケーションの役割ではないかなぁと私は思います。

この辺りは実際にやってみると考え方が変わるかもしれませんので、近々手を付けてみようと思っています。

## 参考

[What is the Jamstack? | Jamstack](https://jamstack.org/what-is-jamstack/)

[モダンWeb開発「JAMstack」を実践 | ShareCOM](https://sharecom.depart-inc.com/tips/depart-engineering-jamstack/)

[インフラエンジニアが見るJAMStack - NRIネットコム Design and Tech Blog](https://tech.nri-net.com/entry/2021/03/31/115504)

[Jamstackとは何か？まずは基本を理解しよう！ | microCMSブログ](https://blog.microcms.io/jamstack-introduction/)